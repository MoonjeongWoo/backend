<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js" integrity="sha512-odNmoc1XJy5x1TMVMdC7EMs3IVdItLPlCeL5vSUPN2llYKMJ2eByTTAIiiuqLg+GdNr9hF6z81p27DArRFKT7A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    </head>
    <body>

      <form>
        <label>아이디 : </label>
        <input type="text" name="user_ID" id="id" required>
        <br>
        <label>비번 : </label>
        <input type="password" name="user_PWD" required>
        <br>
        <label>이름 : </label>
        <input type="text" name="name" required>
        <br>
        <label>나이: </label>
        <input type="number" name="age" required>
        <br>
        <label>프로필 사진</label>
        <input type="file" name="userfile" id="dynamic_file" accept="image/jpg, image/png, image/jpeg" required>
        <br>
        <input type="reset">
        <button onclick="fileUpload();" type="button">제출하기</button>
    </form>
      <img>
        <script>
        
           function fileUpload(){
                  const formData = new FormData();
                  //input file value에 접근 할수 없어서 이렇게 해준다
                 const file = document.getElementById("dynamic_file");
                 var id = document.getElementById("id").value;

                 formData.append("id",id);
                 //보내는 데이터를 추가 하고 싶을때는 append를 사용
                  //input 태그 선택
                  formData.append("userfile",file.files[0]);
                  //formData에 파일을 추가 해주는 기능 앞에는 name 뒤에는 인덱스 값

               
                axios({
                    headers : {
                        "Content-Type" : "multipart/form-data"
                    },
                    //얘는 form의 enctype 속성
                    url: "/upload",
                    //주소 보내기
                    method: "post",
                    //보내는 방법
                    data: formData
                }).then((response)=>{
                    console.log(response.data);
                    document.querySelector("img").src = "/uploads/"+response.data;
                    //쿼리셀렉터를 이용해서 이미지 불러오기
                })
            }
        </script>
        
        <script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.27.2/axios.min.js" integrity="sha512-odNmoc1XJy5x1TMVMdC7EMs3IVdItLPlCeL5vSUPN2llYKMJ2eByTTAIiiuqLg+GdNr9hF6z81p27DArRFKT7A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    </body>
</html>